## Linuxç³»ç»Ÿç”¨æˆ·è´¦å·çš„ç®¡ç†

`useradd é€‰é¡¹ ç”¨æˆ·å`  
é€‰é¡¹:

- -c comment æŒ‡å®šä¸€æ®µæ³¨é‡Šæ€§æè¿°ã€‚
- -d ç›®å½• æŒ‡å®šç”¨æˆ·ä¸»ç›®å½•ï¼Œå¦‚æžœæ­¤ç›®å½•ä¸å­˜åœ¨ï¼Œåˆ™åŒæ—¶ä½¿ç”¨-mé€‰é¡¹ï¼Œå¯ä»¥åˆ›å»ºä¸»ç›®å½•ã€‚
- -g ç”¨æˆ·ç»„ æŒ‡å®šç”¨æˆ·æ‰€å±žçš„ç”¨æˆ·ç»„ã€‚
- -G ç”¨æˆ·ç»„ï¼Œç”¨æˆ·ç»„ æŒ‡å®šç”¨æˆ·æ‰€å±žçš„é™„åŠ ç»„ã€‚
- -s Shellæ–‡ä»¶ æŒ‡å®šç”¨æˆ·çš„ç™»å½•Shellã€‚
- -u ç”¨æˆ·å· æŒ‡å®šç”¨æˆ·çš„ç”¨æˆ·å·ï¼Œå¦‚æžœåŒæ—¶æœ‰-oé€‰é¡¹ï¼Œåˆ™å¯ä»¥é‡å¤ä½¿ç”¨å…¶ä»–ç”¨æˆ·çš„æ ‡è¯†å·ã€‚  
  
å®žä¾‹ï¼š  
`# useradd â€“d  /home/sam -m sam`  
æ­¤å‘½ä»¤åˆ›å»ºäº†ä¸€ä¸ªç”¨æˆ·samï¼Œå…¶ä¸­-då’Œ-mé€‰é¡¹ç”¨æ¥ä¸ºç™»å½•åsamäº§ç”Ÿä¸€ä¸ªä¸»ç›®å½• /home/samï¼ˆ/homeä¸ºé»˜è®¤çš„ç”¨æˆ·ä¸»ç›®å½•æ‰€åœ¨çš„çˆ¶ç›®å½•ï¼‰ã€‚  
`# useradd -s /bin/sh -g group â€“G adm,root gem`
æ­¤å‘½ä»¤æ–°å»ºäº†ä¸€ä¸ªç”¨æˆ·gemï¼Œè¯¥ç”¨æˆ·çš„ç™»å½•Shellæ˜¯ /bin/shï¼Œå®ƒå±žäºŽgroupç”¨æˆ·ç»„ï¼ŒåŒæ—¶åˆå±žäºŽadmå’Œrootç”¨æˆ·ç»„ï¼Œå…¶ä¸­groupç”¨æˆ·ç»„æ˜¯å…¶ä¸»ç»„ã€‚  

### åˆ é™¤å¸å·

`userdel é€‰é¡¹ ç”¨æˆ·å`
å¸¸ç”¨çš„é€‰é¡¹æ˜¯ -rï¼Œå®ƒçš„ä½œç”¨æ˜¯æŠŠç”¨æˆ·çš„ä¸»ç›®å½•ä¸€èµ·åˆ é™¤ã€‚

ä¾‹å¦‚ï¼š

`# userdel -r sam`  
æ­¤å‘½ä»¤åˆ é™¤ç”¨æˆ·samåœ¨ç³»ç»Ÿæ–‡ä»¶ä¸­ï¼ˆä¸»è¦æ˜¯/etc/passwd, /etc/shadow, /etc/groupç­‰ï¼‰çš„è®°å½•ï¼ŒåŒæ—¶åˆ é™¤ç”¨æˆ·çš„ä¸»ç›®å½•ã€‚

## Linuxç³»ç»Ÿç”¨æˆ·ç»„çš„ç®¡ç†

`groupadd é€‰é¡¹ ç”¨æˆ·ç»„`  
å¯ä»¥ä½¿ç”¨çš„é€‰é¡¹æœ‰ï¼š

- -g GID æŒ‡å®šæ–°ç”¨æˆ·ç»„çš„ç»„æ ‡è¯†å·ï¼ˆGIDï¼‰ã€‚  
- -o ä¸€èˆ¬ä¸Ž-gé€‰é¡¹åŒæ—¶ä½¿ç”¨ï¼Œè¡¨ç¤ºæ–°ç”¨æˆ·ç»„çš„GIDå¯ä»¥ä¸Žç³»ç»Ÿå·²æœ‰ç”¨æˆ·ç»„çš„GIDç›¸åŒã€‚  

`# groupadd group1`  
æ­¤å‘½ä»¤å‘ç³»ç»Ÿä¸­å¢žåŠ äº†ä¸€ä¸ªæ–°ç»„group1ï¼Œæ–°ç»„çš„ç»„æ ‡è¯†å·æ˜¯åœ¨å½“å‰å·²æœ‰çš„æœ€å¤§ç»„æ ‡è¯†å·çš„åŸºç¡€ä¸ŠåŠ 1ã€‚  
`# groupadd -g 101 group2`  
æ­¤å‘½ä»¤ä»Žç³»ç»Ÿä¸­åˆ é™¤ç»„group1  
ä¿®æ”¹ç”¨æˆ·ç»„çš„å±žæ€§ä½¿ç”¨groupmodå‘½ä»¤ã€‚å…¶è¯­æ³•å¦‚ä¸‹ï¼š
groupmod é€‰é¡¹ ç”¨æˆ·ç»„
å¸¸ç”¨çš„é€‰é¡¹æœ‰ï¼š

- -g GID ä¸ºç”¨æˆ·ç»„æŒ‡å®šæ–°çš„ç»„æ ‡è¯†å·ã€‚
- -o ä¸Ž-gé€‰é¡¹åŒæ—¶ä½¿ç”¨ï¼Œç”¨æˆ·ç»„çš„æ–°GIDå¯ä»¥ä¸Žç³»ç»Ÿå·²æœ‰ç”¨æˆ·ç»„çš„GIDç›¸åŒã€‚  
- -næ–°ç”¨æˆ·ç»„ å°†ç”¨æˆ·ç»„çš„åå­—æ”¹ä¸ºæ–°åå­—

`# groupmod -g 102 group2`  
æ­¤å‘½ä»¤å°†ç»„group2çš„ç»„æ ‡è¯†å·ä¿®æ”¹ä¸º102ã€‚

`# groupmod â€“g 10000 -n group3 group2`  
æ­¤å‘½ä»¤å°†ç»„group2çš„æ ‡è¯†å·æ”¹ä¸º10000ï¼Œç»„åä¿®æ”¹ä¸ºgroup3ã€‚

å°†ç”¨æˆ·åŠ å…¥åˆ°æ–°ç”¨æˆ·ç»„ä¸”ä¸æ”¹å˜åŽŸæœ‰çš„ç”¨æˆ·ç»„  
`gpasswd -a user groups`

## æ·»åŠ sudoæƒé™å’Œå…å¯†sudo

### ðŸ”‘ ä¸€ã€æ·»åŠ  sudo æƒé™ï¼ˆä¸¤ç§æ–¹æ³•ï¼‰

#### **æ–¹æ³• 1ï¼šé€šè¿‡ç”¨æˆ·ç»„æ·»åŠ ï¼ˆæŽ¨è**

``` bash
# æŸ¥çœ‹ sudo æƒé™ç»„ï¼ˆé€šå¸¸ä¸º sudo æˆ– wheelï¼‰
grep -i '%sudo' /etc/sudoers || grep -i '%wheel' /etc/sudoers

# å°†ç”¨æˆ·åŠ å…¥ sudo ç»„ï¼ˆUbuntu/Debianï¼‰
sudo usermod -aG sudo username

# å°†ç”¨æˆ·åŠ å…¥ wheel ç»„ï¼ˆRHEL/CentOSï¼‰
sudo usermod -aG wheel username
```

#### **æ–¹æ³• 2ï¼šç›´æŽ¥ç¼–è¾‘ sudoers æ–‡ä»¶**

``` bash
# å®‰å…¨ç¼–è¾‘ sudoersï¼ˆä½¿ç”¨ visudo å‘½ä»¤ï¼ï¼‰
sudo visudo

# åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ ï¼š
username ALL=(ALL:ALL) ALL  # æ ‡å‡† sudo æƒé™
```

### ðŸ”“ äºŒã€é…ç½®å…å¯† sudoï¼ˆä¸‰ç§æ–¹æ¡ˆï¼‰

#### **æ–¹æ¡ˆ 1ï¼šå•ç”¨æˆ·å…å¯†**
``` bash
sudo visudo
# æ·»åŠ ï¼š
username ALL=(ALL) NOPASSWD: ALL  # æ‰€æœ‰å‘½ä»¤å…å¯†
```

#### **æ–¹æ¡ˆ 2ï¼šç‰¹å®šå‘½ä»¤å…å¯†**
``` bash
# å…è®¸é‡å¯ Nginx å…å¯†
username ALL=(ALL) NOPASSWD: /usr/sbin/systemctl restart nginx
username ALL=(ALL) NOPASSWD: /usr/sbin/systemctl reload nginx
```

#### **æ–¹æ¡ˆ 3ï¼šç”¨æˆ·ç»„å…å¯†**
``` bash
# æ•´ä¸ªç»„å…å¯†ï¼ˆå¦‚ developers ç»„ï¼‰
%developers ALL=(ALL) NOPASSWD: ALL
```

### âš™ï¸ ä¸‰ã€é«˜çº§é…ç½®æŠ€å·§

#### **1. é™åˆ¶ sudo æƒé™èŒƒå›´**

```
# å…è®¸æ‰§è¡Œç‰¹å®šç›®å½•ä¸‹çš„è„šæœ¬
username ALL=(ALL) NOPASSWD: /usr/local/scripts/*
```

#### **2. å¸¦çŽ¯å¢ƒå˜é‡çš„ sudo**

```
# å…è®¸ä¿ç•™ PATH çŽ¯å¢ƒå˜é‡
Defaults env_keep += "PATH"
```

#### **3. è¶…æ—¶è®¾ç½®**

```
# å»¶é•¿ sudo ä¼šè¯è¶…æ—¶ï¼ˆé»˜è®¤ 15 åˆ†é’Ÿï¼‰
Defaults timestamp_timeout=30  # å•ä½ï¼šåˆ†é’Ÿ
```

## chattrå‘½ä»¤

æœ‰æ—¶å€™ä½ å‘çŽ°ç”¨`root`æƒé™éƒ½ä¸èƒ½ä¿®æ”¹æŸä¸ªæ–‡ä»¶ï¼Œå¤§éƒ¨åˆ†åŽŸå› æ˜¯æ›¾ç»ç”¨`chattr`å‘½ä»¤é”å®šè¯¥æ–‡ä»¶äº†ã€‚

é€šè¿‡`chattr`å‘½ä»¤ä¿®æ”¹å±žæ€§èƒ½å¤Ÿæé«˜ç³»ç»Ÿçš„å®‰å…¨æ€§ï¼Œä½†æ˜¯å®ƒå¹¶ä¸é€‚åˆæ‰€æœ‰çš„ç›®å½•ã€‚chattrå‘½ä»¤ä¸èƒ½ä¿æŠ¤`/`ã€`/dev`ã€`/tmp`ã€`/var`ç›®å½•ã€‚

`lsattr`å‘½ä»¤æ˜¯æ˜¾ç¤º`chattr`å‘½ä»¤è®¾ç½®çš„æ–‡ä»¶å±žæ€§ã€‚

è¿™ä¸¤ä¸ªå‘½ä»¤æ˜¯ç”¨æ¥æŸ¥çœ‹å’Œæ”¹å˜æ–‡ä»¶ã€ç›®å½•å±žæ€§çš„ï¼Œä¸Ž`chmod`è¿™ä¸ªå‘½ä»¤ç›¸æ¯”ï¼Œ`chmod`åªæ˜¯æ”¹å˜æ–‡ä»¶çš„è¯»å†™ã€æ‰§è¡Œæƒé™ï¼Œæ›´åº•å±‚çš„å±žæ€§æŽ§åˆ¶æ˜¯ç”±`chattr`æ¥æ”¹å˜çš„ã€‚

### chattrå‘½ä»¤çš„ç”¨æ³•

`chattr [ -RVf ] [ -v version ] [ mode ] filesâ€¦`  
æœ€å…³é”®çš„æ˜¯åœ¨`[mode]`éƒ¨åˆ†ï¼Œ`[mode]`éƒ¨åˆ†æ˜¯ç”±+-=å’Œ`[ASacDdIijsTtu]`è¿™äº›å­—ç¬¦ç»„åˆçš„ï¼Œè¿™éƒ¨åˆ†æ˜¯ç”¨æ¥æŽ§åˆ¶æ–‡ä»¶çš„å±žæ€§ã€‚

- +ï¼šåœ¨åŽŸæœ‰å‚æ•°è®¾å®šåŸºç¡€ä¸Šï¼Œè¿½åŠ å‚æ•°ã€‚
- -ï¼šåœ¨åŽŸæœ‰å‚æ•°è®¾å®šåŸºç¡€ä¸Šï¼Œç§»é™¤å‚æ•°ã€‚
- =ï¼šæ›´æ–°ä¸ºæŒ‡å®šå‚æ•°è®¾å®šã€‚
- Aï¼šæ–‡ä»¶æˆ–ç›®å½•çš„ `atime (access time)` ä¸å¯è¢«ä¿®æ”¹`(modified)`, å¯ä»¥æœ‰æ•ˆé¢„é˜²ä¾‹å¦‚æ‰‹æç”µè„‘ç£ç›˜I/Oé”™è¯¯çš„å‘ç”Ÿã€‚
- Sï¼šç¡¬ç›˜I/OåŒæ­¥é€‰é¡¹ï¼ŒåŠŸèƒ½ç±»ä¼¼syncã€‚
- aï¼šå³`append`ï¼Œè®¾å®šè¯¥å‚æ•°åŽï¼Œåªèƒ½å‘æ–‡ä»¶ä¸­æ·»åŠ æ•°æ®ï¼Œè€Œä¸èƒ½åˆ é™¤ï¼Œå¤šç”¨äºŽæœåŠ¡å™¨æ—¥å¿—æ–‡ä»¶å®‰å…¨ï¼Œåªæœ‰rootæ‰èƒ½è®¾å®šè¿™ä¸ªå±žæ€§ã€‚
- cï¼šå³`compresse`ï¼Œè®¾å®šæ–‡ä»¶æ˜¯å¦ç»åŽ‹ç¼©åŽå†å­˜å‚¨ã€‚è¯»å–æ—¶éœ€è¦ç»è¿‡è‡ªåŠ¨è§£åŽ‹æ“ä½œã€‚
- dï¼šå³`no dump`ï¼Œè®¾å®šæ–‡ä»¶ä¸èƒ½æˆä¸ºdumpç¨‹åºçš„å¤‡ä»½ç›®æ ‡ã€‚
- iï¼šè®¾å®šæ–‡ä»¶ä¸èƒ½è¢«åˆ é™¤ã€æ”¹åã€è®¾å®šé“¾æŽ¥å…³ç³»ï¼ŒåŒæ—¶ä¸èƒ½å†™å…¥æˆ–æ–°å¢žå†…å®¹ã€‚iå‚æ•°å¯¹äºŽæ–‡ä»¶ç³»ç»Ÿçš„å®‰å…¨è®¾ç½®æœ‰å¾ˆå¤§å¸®åŠ©ã€‚
- jï¼šå³`journal`ï¼Œè®¾å®šæ­¤å‚æ•°ä½¿å¾—å½“é€šè¿‡`mount`å‚æ•°ï¼š`data=ordered` æˆ–è€… `data=writeback` æŒ‚è½½çš„æ–‡ä»¶ç³»ç»Ÿï¼Œæ–‡ä»¶åœ¨å†™å…¥æ—¶ä¼šå…ˆè¢«è®°å½•(åœ¨`journal`ä¸­)ã€‚å¦‚æžœ`filesystem`è¢«è®¾å®šå‚æ•°ä¸º `data=journal`ï¼Œåˆ™è¯¥å‚æ•°è‡ªåŠ¨å¤±æ•ˆã€‚
- sï¼šä¿å¯†æ€§åœ°åˆ é™¤æ–‡ä»¶æˆ–ç›®å½•ï¼Œå³ç¡¬ç›˜ç©ºé—´è¢«å…¨éƒ¨æ”¶å›žã€‚
- uï¼šä¸Žsç›¸åï¼Œå½“è®¾å®šä¸ºuæ—¶ï¼Œæ•°æ®å†…å®¹å…¶å®žè¿˜å­˜åœ¨ç£ç›˜ä¸­ï¼Œå¯ä»¥ç”¨äºŽ`undeletion`ã€‚

## è®¿é—®æŽ§åˆ¶åˆ—è¡¨(ACL)

### æŸ¥çœ‹æ–‡ä»¶ç³»ç»Ÿæ˜¯å¦æ”¯æŒACL

`dumpe2fs -h /dev/sda2`

### åŠ è½½ACLåŠŸèƒ½

`mount -o remount,acl /`  
`mount -va`  
åŒæ ·ä¹Ÿå¯ä»¥ä¿®æ”¹ç£ç›˜æŒ‚åœ¨é…ç½®æ–‡ä»¶è®¾ç½®é»˜è®¤å¼€æœºåŠ è½½  

``` bash
> vi /etc/fstab
LABEL=/     /     ext3  defaults,acl    1 1
```

`getfacl`æŸ¥çœ‹æ–‡ä»¶aclæƒé™  
`setfacl`è®¾ç½®æ–‡ä»¶aclæƒé™  

### é€‰é¡¹ä¸Žå‚æ•°

- -m:è®¾ç½®åŽç»­çš„aclå‚æ•°ï¼Œä¸å¯ä¸Ž-xä¸€èµ·ä½¿ç”¨
- -x: åˆ é™¤åŽç»­çš„aclå‚æ•°ï¼Œä¸å¯ä¸Ž-mä¸€èµ·ä½¿ç”¨
- -b:åˆ é™¤æ‰€æœ‰çš„aclå‚æ•°
- -k:åˆ é™¤é»˜è®¤çš„aclå‚æ•°
- -R:é€’å½’è®¾ç½®aclå‚æ•°
- -d:è®¾ç½®é»˜è®¤aclå‚æ•°ï¼Œåªå¯¹ç›®å½•æœ‰æ•ˆ

### å¤‡ä»½å’Œæ¢å¤ ACL æƒé™

å¸¸è§çš„æ–‡ä»¶æ“ä½œå‘½ä»¤ `cp` å’Œ `mv` ç­‰éƒ½æ”¯æŒ `ACL` æƒé™ï¼Œåªæ˜¯ `cp` å‘½ä»¤éœ€è¦åŠ ä¸Š `-p` å‚æ•°ã€‚ä½†æ˜¯ `tar` ç­‰å¸¸è§çš„å¤‡ä»½å·¥å…·ä¸ä¼šä¿ç•™ç›®å½•å’Œæ–‡ä»¶çš„ `ACL` æƒé™ä¿¡æ¯ã€‚å¦‚æžœå¸Œæœ›å¤‡ä»½å’Œæ¢å¤å¸¦æœ‰ `ACL` æƒé™çš„æ–‡ä»¶å’Œç›®å½•ï¼Œå¯ä»¥å…ˆæŠŠ `ACL` æƒé™ä¿¡æ¯å¤‡ä»½åˆ°ä¸€ä¸ªæ–‡ä»¶é‡Œï¼Œç„¶åŽå†ç”¨ -restore é€‰é¡¹æ¥æ¢å¤è¿™äº›ä¿¡æ¯ã€‚

ä½¿ç”¨å‘½ä»¤å¤‡ä»½æ–‡ä»¶å¤¹`acldir`çš„`acl`æƒé™  
`getfacl -R acldir > acldir.acl`
